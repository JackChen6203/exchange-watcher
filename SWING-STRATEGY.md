# 波段策略功能說明

## 功能概述

波段策略是一個自動監控大市值加密貨幣的技術分析工具，基於 EMA（指數移動平均線）12、30、55 的多空頭排列來識別趨勢機會。當滿足特定條件時，系統會自動發送 Discord 通知，提供進場點位和目標價位建議。

## 監控條件

### 多頭排列
- **條件**：EMA12 > EMA30 > EMA55
- **狀態**：三條均線呈現上升趨勢且不糾纏
- **信號**：價格觸碰 EMA30 且未觸碰 EMA55

### 空頭排列
- **條件**：EMA12 < EMA30 < EMA55
- **狀態**：三條均線呈現下降趨勢且不糾纏
- **信號**：價格觸碰 EMA30 且未觸碰 EMA55

### 均線糾纏檢測
系統會自動檢測均線是否糾纏（三條均線距離過近），只有在均線不糾纏的情況下才會觸發信號。

## 信號觸發邏輯

1. **趨勢確認**：檢測 EMA 12、30、55 是否形成明確的多頭或空頭排列
2. **糾纏檢測**：確保三條均線沒有糾纏在一起
3. **EMA55 檢查**：確認在整個趨勢過程中未觸碰 EMA55
4. **EMA30 觸碰**：當價格觸碰 EMA30 時觸發通知
5. **冷卻機制**：每個交易對每 4 小時最多發送一次通知，避免重複提醒

## 通知格式

### Discord 通知內容
```
🎯 **波段策略信號**

**交易對**: BTC/USDT
**策略方向**: 多頭波段
**時間週期**: 1h
**開盤價**: $45,000.00
**實盤價**: $45,450.00 (+1.0%)
**TP1**: $46,132.50 (+2.5%)

**技術分析**:
✅ EMA12 > EMA30 > EMA55 (多頭排列)
✅ 均線無糾纏
✅ 未觸碰 EMA55
✅ 觸碰 EMA30

⏰ 時間: 2024-01-15 14:30:00
```

### 價格計算邏輯
- **多頭策略**：
  - 實盤價 = 開盤價 × (1 + 1%) = 開盤價 × 1.01
  - TP1 = 實盤價 × (1 + 1.5%) = 實盤價 × 1.015

- **空頭策略**：
  - 實盤價 = 開盤價 × (1 - 1%) = 開盤價 × 0.99
  - TP1 = 實盤價 × (1 - 1.5%) = 實盤價 × 0.985

## 配置說明

### 環境變數設定
在 `.env` 文件中添加以下配置：

```env
# 波段策略 Discord Webhook URL
SWING_STRATEGY_WEBHOOK_URL=https://discord.com/api/webhooks/your-webhook-url

# Bitget API 配置（必需）
BITGET_API_KEY=your-api-key
BITGET_SECRET_KEY=your-secret-key
BITGET_PASSPHRASE=your-passphrase
```

### Discord Webhook 設定
1. 在 Discord 伺服器中創建專用頻道
2. 進入頻道設定 → 整合 → Webhook
3. 創建新的 Webhook 並複製 URL
4. 將 URL 設定到 `SWING_STRATEGY_WEBHOOK_URL` 環境變數

## 監控週期

系統同時監控三個時間週期：
- **1小時 (1h)**：主要趨勢分析
- **30分鐘 (30m)**：中期趨勢確認
- **15分鐘 (15m)**：短期進場時機

每個時間週期獨立分析，當任一週期滿足條件時即會發送通知。

## 監控幣種

系統自動監控前 50 大市值的 USDT 永續合約，包括但不限於：
- BTC/USDT
- ETH/USDT
- BNB/USDT
- SOL/USDT
- ADA/USDT
- DOT/USDT
- LINK/USDT
- 等其他大市值幣種

幣種列表會根據市值排名動態更新。

## 技術指標說明

### EMA（指數移動平均線）
- **EMA12**：12 期指數移動平均線，反應短期趨勢
- **EMA30**：30 期指數移動平均線，反應中期趨勢
- **EMA55**：55 期指數移動平均線，反應長期趨勢

### 計算公式
```
EMA = (收盤價 × 平滑係數) + (前一期EMA × (1 - 平滑係數))
平滑係數 = 2 / (週期 + 1)
```

## 測試命令

### 運行波段策略測試
```bash
# 運行波段策略專用測試
npm run test:swing

# 運行所有測試（包含波段策略）
npm run test:all

# 運行基礎測試
npm test
```

### 測試內容
- EMA 計算準確性驗證
- 多空頭排列判斷邏輯
- 均線糾纏檢測功能
- 觸碰信號檢測
- Discord 通知格式化

## 系統架構

### 核心組件
- **SwingStrategyService**：波段策略主服務
- **BitgetApi**：Bitget 交易所 API 接口
- **DiscordService**：Discord 通知服務

### 數據流程
1. 從 Bitget API 獲取 K 線數據
2. 計算 EMA 12、30、55 指標
3. 分析趨勢狀態和均線排列
4. 檢測觸碰信號
5. 發送 Discord 通知

## 注意事項

1. **網路連接**：確保網路連接穩定，避免數據獲取失敗
2. **API 限制**：注意 Bitget API 的請求頻率限制
3. **資金管理**：通知僅供參考，請自行評估風險
4. **回測驗證**：建議先進行回測驗證策略有效性
5. **監控狀態**：定期檢查系統運行狀態和日誌

## 故障排除

### 常見問題
1. **無法獲取數據**：檢查 Bitget API 配置和網路連接
2. **通知未發送**：檢查 Discord Webhook URL 配置
3. **EMA 計算錯誤**：確認 K 線數據完整性
4. **重複通知**：檢查冷卻機制是否正常運作

### 日誌查看
系統會記錄詳細的運行日誌，包括：
- API 請求狀態
- EMA 計算結果
- 信號觸發記錄
- 通知發送狀態

---

**免責聲明**：本策略僅供參考，不構成投資建議。加密貨幣交易存在高風險，請謹慎投資。